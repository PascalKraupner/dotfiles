#!/bin/bash

SDDM_CONF="/etc/sddm.conf.d/autologin.conf"

if [[ ! -f "$SDDM_CONF" ]]; then
  echo "[!] $SDDM_CONF not found. Run chezmoi apply first to set up autologin." >&2
  exit 1
fi

if [[ -z "$1" ]]; then
  # No argument: remove the Autologin block so SDDM shows the session picker
  echo "[*] Disabling SDDM autologin (session picker will appear on next login)..."
  sudo sed -i '/^\[Autologin\]/,/^\[/{/^\[Autologin\]/d;/^\[/!d}' "$SDDM_CONF"
  # Scrub any trailing blank lines left behind
  sudo sed -i '/^$/d' "$SDDM_CONF"
  echo "[*] Autologin disabled."
else
  SESSION="$1"
  echo "[*] Switching SDDM autologin session to: $SESSION"
  sudo sed -i "s/^Session=.*/Session=$SESSION/" "$SDDM_CONF"
  echo "[*] Done. Next login will use session: $SESSION"
fi
